<div class="app-shell">
  <!-- SIDEBAR: Refined Navigation -->
  <aside class="sidebar-container" role="navigation">
    <div class="sidebar-header">
      <div class="logo-wrapper">
        <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M42.4379 44C42.4379 44 36.0744 33.9038 41.1692 24C46.8624 12.9336 42.2078 4 42.2078 4L7.01134 4C7.01134 4 11.6577 12.932 5.96912 23.9969C0.876273 33.9029 7.27094 44 7.27094 44L42.4379 44Z"
            fill="currentColor"
          ></path>
        </svg>
      </div>
      <h1 class="logo-title">Entrepôts</h1>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <p class="section-label">Menu</p>
        <a
          [routerLink]="'/userdashboard/userdashboardmain'"
          routerLinkActive="active"
          class="sidebar-link"
        >
          <span class="material-symbols-outlined">dashboard</span>
          <span class="link-label">Tableau de bord</span>
        </a>
        <a 
          *ngIf="userEntrepotId !== null"
          [routerLink]="['/userdashboard/userentrepot', userEntrepotId]" 
          routerLinkActive="active" 
          class="sidebar-link"
        >
          <span class="material-symbols-outlined">warehouse</span>
          <span class="link-label">Entrepôt</span>
        </a>
        <a [routerLink]="'/userdashboard/userEmpotage'" routerLinkActive="active" class="sidebar-link">
          <span class="material-symbols-outlined">inventory_2</span>
          <span class="link-label">Empotage</span>
        </a>
      </div>
    </nav>
      <div class="sidebar-footer">
      <a href="#" class="sidebar-link secondary">
        <span class="material-symbols-outlined">help</span>
        <span class="link-label">Centre d'aide</span>
      </a>
      <div class="footer-divider"></div>
      <a href="#" class="sidebar-link logout" (click)="$event.preventDefault(); logout()">
        <span class="material-symbols-outlined">logout</span>
        <span class="link-label">Déconnexion</span>
      </a>
    </div>
  </aside>

  <!-- MAIN AREA: Contents & Topbar -->
  <div class="content-wrapper">
    <!-- TOPBAR: Glassmorphism & Profile -->
    <header class="top-header">
      <div class="top-header-left">
        <!-- Breadcrumb or Search placeholder can go here -->
      </div>

      <div class="top-header-right">
        <!-- NOTIFICATIONS -->
        <div class="notification-container" (click)="$event.stopPropagation()">
          <button
            class="notif-button"
            type="button"
            (click)="toggleNotifications()"
            [attr.aria-expanded]="showNotifDropdown"
          >
            <span class="material-symbols-outlined">notifications</span>
            <span *ngIf="notifCount > 0" class="notif-badge-dot"></span>
          </button>

          <!-- DROPDOWN PANEL -->
          <div class="notif-popover" *ngIf="showNotifDropdown">
            <div class="popover-header">
              <h3 class="popover-title">Notifications</h3>
              <span class="popover-count" *ngIf="notifCount > 0">{{ notifCount }}</span>
            </div>

            <div class="popover-scroll custom-scroll">
              <div *ngIf="notifications.length === 0" class="popover-empty">
                <span class="material-symbols-outlined">notifications_off</span>
                <p>Aucune notification</p>
              </div>

              <div
                *ngFor="let n of notifications"
                class="notif-card-item"
                (click)="openNotification(n)"
              >
                <div class="notif-icon-circle">
                  <span class="material-symbols-outlined">local_shipping</span>
                </div>
                <div class="notif-body">
                  <div class="notif-row">
                    <span class="notif-immat">{{ n.immatriculation }}</span>
                  </div>
                  <p class="notif-subtitle">{{ n.entrepotName }}</p>
                  <p class="notif-subtitle" style="font-size:0.75rem; color: var(--primary);">{{ n.statut }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- USER PROFILE AREA -->
        <div class="profile-block">
          <div
            class="profile-avatar"
            style="
              background-image: url('https://ui-avatars.com/api/?name={{userName}}&background=random');
            "
          ></div>
          <div class="profile-info">
            <p class="name">{{ userName }}</p>
            <p class="role">{{ userRoleLabel }}</p>
          </div>
          <button class="profile-toggle">
            <span class="material-symbols-outlined">expand_more</span>
          </button>
        </div>
      </div>
    </header>

    <!-- PAGE VIEWPORT -->
    <main class="page-overflow admin-scroll">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>
